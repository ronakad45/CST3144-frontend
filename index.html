<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Lessons</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> After School Lessons</h1>
            <div class="header-controls">
                <input v-model="searchQuery" type="text" placeholder="Search lessons." class="search-box">
                <button class="cart-button" v-on:click="changePages" :disabled="cart.length === 0">
                    <i class="fas fa-shopping-cart"></i>
                    Cart
                    <span v-if="cart.length > 0" class="cart-badge">{{ cartItemCount }}</span>
                </button>
            </div>
        </div>


        <div v-if="!showCart">
            <div class="sort-controls">
                <label>Sort by:</label>
                <select v-model="sortAttributes">
                    <option value="subject">Subject</option>
                    <option value="location">Location</option>
                    <option value="price">Price</option>
                    <option value="spaces">Availability</option>
                </select>
                
                <label>Order:</label>
                <select v-model="sortOrders">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                </select>
            </div>
            <div class="lessons-grid">
                <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-card">
                    <div class="lesson-icon">
                        <i :class="lesson.icon"></i>
                    </div>
                    <h3>{{ lesson.subject }}</h3>
                    <div class="lesson-info">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ lesson.location }}</span>
                    </div>
                    <div class="price">AED {{ lesson.price }}</div>
                    <div class="rating">
                        <i class="fas fa-star star" v-for="n in lesson.rating" :key="n"></i>
                        <i class="far fa-star star" v-for="n in (5 - lesson.rating)" :key="n + 10"></i>
                        ({{ lesson.rating }}/5)
                    </div>
                    <div class="lesson-info spaces">
                        <i class="fas fa-users"></i>
                        <span>{{ lesson.spaces }} spaces available</span>
                    </div>
                    <button class="add-to-cart-btn" v-on:click="addToCart(lesson)" :disabled="lesson.spaces === 0">
                        <i class="fas fa-cart-plus"></i> 
                        {{ lesson.spaces === 0 ? 'Sold Out' : 'Add to Cart' }}
                    </button>
                </div>
            </div>
        </div>

        <div v-else class="cart-page">
            <h2><i class="fas fa-shopping-cart"></i> Shopping Cart</h2>

            <div v-if="cart.length === 0" class="empty-cart">
                <i class="fas fa-shopping-basket" style="font-size: 30px; margin-bottom: 15px;"></i>
                <p>Your Cart looks empty</p>
            </div>

            <div v-else>
                <div v-for="item in cart" :key="item.id" class="cart-item">
                    <div class="cart-item-info">
                        <h4>{{ item.subject }}</h4>
                        <p>{{ item.location }} - AED {{ item.price }}</p>
                        <p>Quantity: {{ item.quantity }}</p>
                    </div>
                    <button class="remove-btn" v-on:click="removeFromCart(item)">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>

                <div class="total-amount">
                    Total: AED {{totalPrice}}
                </div>
                
                <div class="checkout-section">
                    <h3>Checkout</h3>
                    <div v-if="!orderConfirmed">
                        <div class="form-group">
                            <label>Full Name (letters only):</label>
                            <input v-model="order.customerName" type="text" placeholder="Enter your name":class="{ valid: isNameValid, invalid: order.customerName && !isNameValid }">
                            <label>Phone Number (numbers only):</label>
                            <input v-model="order.customerPhone" type="text" placeholder="Enter your phone number":class="{ valid: isPhoneValid, invalid: order.customerPhone && !isPhoneValid }">
                    
                            <label>Address:</label>
                            <input v-model="order.address" type="text" placeholder="Enter your address">
                            <label>City:</label>
                            <input v-model="order.city" type="text" placeholder="Enter city">

                            <label>Emirate:</label>
                            <select v-model="order.emirate">
                                <option disabled value="">Select Emirate</option>
                                <option>Dubai</option>
                                <option>Abu Dhabi</option>
                                <option>Sharjah</option>
                                <option>Fujairah</option>
                            </select>
                    
                            <label>Postal Code:</label>
                            <input v-model="order.zip" type="text" placeholder="Enter postal code">
                            <div>
                                <input type="checkbox" id="gift" v-model="order.gift">
                                <label for="gift" style="display: inline;">Ship As Gift?</label>
                            </div>
                            <button class="checkout-btn" v-on:click="checkout":disabled="!isCheckoutEnabled">
                                <i class="fas fa-check-circle"></i> Complete Order
                            </button>
                        </div>
                    </div>
                </div>
                <div v-if="orderConfirmed" class="confirmation-message">
                    <i class="fas fa-check-circle" style="font-size: 40px; margin-bottom: 15px;"></i>
                    <h2>Order Successfully Submitted!</h2>
                    <p>Thank you for your purchase!</p>
                    
                    <div class="order-summary">
                        <h3>Order Information</h3>
                        
                        <h4 style="margin-top: 15px;">Items Ordered:</h4>
                        <div v-for="item in confirmedCart" :key="item.id" class="order-item">
                            {{ item.subject }} - {{ item.location }} (Qty: {{ item.quantity }}) - AED {{ item.price * item.quantity }}
                        </div>
                        
                        <div style="border-top: 2px solid #ddd; margin-top: 10px; padding-top: 10px; font-size: 18px;">
                            <strong>Total: AED {{ confirmedTotal }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

     <script>
        let afterSchool = new Vue({
            el: '#app',
            data: {
                sitename: "After School lessons ",
                lessons: [
                    { id: 1, subject: 'Mathematics', location: 'Dubai Knowledge Park', price: 100, spaces: 5, rating: 4, icon: 'fas fa-calculator' },
                    { id: 2, subject: 'Sports', location: 'Dubai Marina', price: 80, spaces: 5, rating: 5, icon: 'fas fa-futbol' },
                    { id: 3, subject: 'Martial Arts', location: 'Jumeirah', price: 90, spaces: 5, rating: 4, icon: 'fas fa-hand-rock' },
                    { id: 4, subject: 'History', location: 'Business Bay', price: 95, spaces: 5, rating: 3, icon: 'fas fa-landmark' },
                    { id: 5, subject: 'Cooking', location: 'Al Quoz', price: 85, spaces: 5, rating: 5, icon: 'fas fa-utensils' },
                    { id: 6, subject: 'Art', location: 'Dubai Marina', price: 75, spaces: 5, rating: 4, icon: 'fas fa-palette' },
                    { id: 7, subject: 'Music', location: 'Academic City', price: 110, spaces: 5, rating: 5, icon: 'fas fa-music' },
                    { id: 8, subject: 'Physical Education', location: 'Silicon Oasis', price: 70, spaces: 5, rating: 3, icon: 'fas fa-running' },
                    { id: 9, subject: 'Computer Science', location: 'Sharjah', price: 120, spaces: 5, rating: 4, icon: 'fas fa-laptop-code' },
                    { id: 10, subject: 'French', location: 'Fujairah', price: 90, spaces: 5, rating: 4, icon: 'fas fa-language' }
                ],
                cart: [],
                showCart: false,
                searchQuery: '',
                sortAttributes: 'subject', // will sort by 'subject' by default
                sortOrders: 'asc', //will sort by ascending by default
                order: {
                    customerName: '',
                    customerPhone: '',
                    address: '',
                    city: '',
                    zip: '',
                    emirate: '',
                    gift: false
                },
                orderConfirmed: false,
                confirmedOrder: {},
                confirmedCart: [],
                confirmedTotal: 0
            },
            computed:{
                sortedLessons() {
                    const lessons = [...this.filteredLessons]; // this takes filtered + sorted list
                    
                    lessons.sort((a, b) => {
                        let aVal = a[this.sortAttributes];
                        let bVal = b[this.sortAttributes];
                        
                        if (typeof aVal === 'string') {
                            aVal = aVal.toLowerCase();
                            bVal = bVal.toLowerCase();
                        }
                        
                        if (this.sortOrders === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });
                
                    return lessons;
                },
                filteredLessons() {
                // It returns sorted lessons array 
                //implements it in the search and filters lessons based on searchQuery
                    if (!this.searchQuery) {
                        return this.lessons;
                    }
                    const query = this.searchQuery.toLowerCase();
                    return this.lessons.filter(lesson => {
                        return lesson.subject.toLowerCase().includes(query) ||
                               lesson.location.toLowerCase().includes(query) ||
                               lesson.price.toString().includes(query) ||
                               lesson.spaces.toString().includes(query);
                    });
                },
                cartItemCount() {
                    return this.cart.reduce((total, item) => total + item.quantity, 0);
                },
                totalPrice() {
                    return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                },
                isNameValid() {
                    return /^[A-Za-z\s]+$/.test(this.order.customerName) && this.order.customerName.trim().length > 0;
                },
                isPhoneValid() {
                    return /^[0-9]+$/.test(this.order.customerPhone) && this.order.customerPhone.length > 0;
                },
                isCheckoutEnabled() {
                    return this.isNameValid && 
                           this.isPhoneValid && 
                           this.order.address.trim() && 
                           this.order.city.trim() && 
                           this.order.emirate && 
                           this.order.zip.trim() && 
                           this.cart.length > 0;
                }
            },
            methods: {
                addToCart(lesson) {
                    if (lesson.spaces > 0) {
                        const cartItem = this.cart.find(item => item.id === lesson.id);
                        if (cartItem) {
                            cartItem.quantity++;
                        } else {
                            this.cart.push({
                                id: lesson.id,
                                subject: lesson.subject,
                                location: lesson.location,
                                price: lesson.price,
                                quantity: 1
                            });
                        }
                        
                        lesson.spaces--;
                    }
                },
                removeFromCart(item) {
                    const lesson = this.lessons.find(l => l.id === item.id);
                    if (lesson) {
                        lesson.spaces += item.quantity;
                    }
                    const index = this.cart.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.cart.splice(index, 1);
                    }
                },
                changePages() {
                    this.showCart = !this.showCart;
                },
                checkout() {
                    if (this.isCheckoutEnabled) {
                        this.confirmedOrder = JSON.parse(JSON.stringify(this.order));
                        this.confirmedCart = JSON.parse(JSON.stringify(this.cart));
                        this.confirmedTotal = this.totalPrice;
                        this.orderConfirmed = true;
                    }
                },
            }
        });
    </script>
</body>
</html>